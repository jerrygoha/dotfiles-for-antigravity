# Session Management Guide

Antigravity 세션을 효과적으로 관리하는 방법.

---

## 🎯 핵심 원칙

### 100K 토큰 기준

**100,000 tokens** = 새 세션 전환 권장 시점

- 세션 토큰 사용량이 100K 초과 시 응답 품질 저하 가능
- `/handoff`로 상태 저장 후 새 세션 시작 권장

---

## 🔄 Handoff/Pickup 워크플로우

### 상태 저장 (Handoff)

```
/handoff
```

생성되는 파일: `.agent/handoffs/YYYY-MM-DD-[slug].md`

### 상태 복원 (Pickup)

```
/pickup [handoff-filename]
```

예: `/pickup 2026-01-21-implement-auth`

---

## 📋 Handoff 문서 구조

```markdown
# [Readable Summary]

## 1. Primary Request and Intent
[사용자의 요청 및 의도]

## 2. Key Technical Concepts
- [개념 1]
- [개념 2]

## 3. Files and Code Sections
### [파일명]
- **Why important**: [중요한 이유]
- **Changes made**: [변경 사항]

## 4. Problem Solving
[해결한 문제 및 진행 중인 트러블슈팅]

## 5. Pending Tasks
- [ ] Task 1
- [ ] Task 2

## 6. Current Work
[핸드오프 직전 작업 중이던 내용]

## 7. Next Steps
[권장 다음 작업]
```

---

## ⏰ 언제 Handoff 해야 하나요?

### 권장 시점

| 상황 | 이유 |
|------|------|
| 100K 토큰 초과 예상 시 | 응답 품질 유지 |
| 복잡한 디버깅 중 | 컨텍스트 보존 |
| 대규모 리팩토링 단계 완료 | 진행 상황 저장 |
| 2-3시간 연속 작업 후 | 정기적 백업 |
| 중요 마일스톤 달성 시 | 이력 보존 |

### 권장하지 않는 시점

| 상황 | 이유 |
|------|------|
| 간단한 버그 수정 | 오버헤드 |
| 단일 파일 편집 | 불필요 |
| 질문에 대한 답변 | 컨텍스트 최소 |

---

## 💡 Best Practices

### 1. 대규모 리팩토링

```
1. /plan - 전체 계획 수립
2. Phase 1 완료 → /handoff
3. 새 세션 → /pickup
4. Phase 2 진행
5. 반복...
```

### 2. 복잡한 디버깅

```
1. 문제 재현 테스트 작성
2. 가설 검증
3. 해결 완료 → /learn (패턴 저장)
4. /handoff (상태 저장)
```

### 3. 장시간 개발

```
2-3시간마다:
1. 현재 작업 완료
2. /handoff
3. 새 세션 시작
4. /pickup
5. 계속 작업
```

---

## 🔧 컨텍스트 최적화

### 토큰 절약 팁

1. **선택적 파일 읽기**
   - 전체 파일 대신 필요한 라인 범위만 요청
   - `view_file StartLine:100 EndLine:150`

2. **간결한 요청**
   - 불필요한 컨텍스트 반복 X
   - 명확하고 구체적인 요청

3. **단계별 작업**
   - 한 번에 하나의 작업에 집중
   - 완료 후 다음 작업으로 이동

4. **대용량 출력 제한**
   - 로그는 마지막 N줄만 요청
   - 큰 결과는 파일로 저장 후 필요한 부분만 확인

---

## 📊 토큰 사용량 추정

| 작업 유형 | 예상 토큰 |
|----------|----------|
| 간단한 질문 답변 | 1K-5K |
| 단일 파일 편집 | 5K-15K |
| 여러 파일 수정 | 15K-30K |
| 새 기능 구현 | 30K-60K |
| 대규모 리팩토링 | 60K-100K+ |
| 복잡한 디버깅 | 40K-80K |

---

## 🚨 경고 신호

다음 신호가 보이면 `/handoff` 고려:

- 에이전트 응답이 느려짐
- 이전 컨텍스트를 자주 잊음
- 같은 실수 반복
- 응답이 불완전하거나 잘림

---

## 관련 워크플로우

- `/handoff` - 세션 상태 저장
- `/pickup` - 이전 세션 복원
- `/learn` - 세션에서 패턴 추출
- `/plan` - 복잡한 작업 계획
